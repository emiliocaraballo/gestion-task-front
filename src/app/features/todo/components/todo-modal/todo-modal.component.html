<!-- Modal Backdrop -->
<div class="modal-backdrop" 
     [class.show]="isOpen" 
     (click)="onClose()"
     *ngIf="isOpen">
</div>

<!-- Modal Container -->
<div class="modal-container" 
     [class.show]="isOpen" 
     *ngIf="isOpen">
  
  <div class="modal-content" (click)="$event.stopPropagation()">
    <!-- Modal Header -->
    <header class="modal-header">
      <div class="modal-title">
        <div class="title-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" *ngIf="mode === 'create'"/>
            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" *ngIf="mode === 'edit'"/>
          </svg>
        </div>
        <div class="title-text">
          <h2>{{ getModalTitle() }}</h2>
          <p>{{ mode === 'create' ? 'Crea una nueva tarea y organiza tu día' : 'Modifica los detalles de tu tarea' }}</p>
        </div>
      </div>
      <button class="close-btn" (click)="onClose()" type="button">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
    </header>

    <!-- Modal Body -->
    <div class="modal-body">
      <form [formGroup]="todoForm" (ngSubmit)="onSave()" class="todo-form">
        
        <!-- Title Field -->
        <div class="form-group">
          <label for="title" class="form-label">
            <span class="label-text">Título</span>
            <span class="required">*</span>
          </label>
          <div class="input-wrapper">
            <input
              id="title"
              type="text"
              formControlName="title"
              placeholder="¿Qué necesitas hacer?"
              class="form-input"
              [class.error]="titleControl?.invalid && titleControl?.touched"
              autocomplete="off">
            <div class="input-icon">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
              </svg>
            </div>
          </div>
          <div class="form-errors" *ngIf="titleControl?.invalid && titleControl?.touched">
            <span *ngIf="titleControl?.errors?.['required']" class="error-message">
              El título es requerido
            </span>
            <span *ngIf="titleControl?.errors?.['minlength']" class="error-message">
              Mínimo 3 caracteres
            </span>
            <span *ngIf="titleControl?.errors?.['maxlength']" class="error-message">
              Máximo 100 caracteres
            </span>
          </div>
        </div>

        <!-- Description Field -->
        <div class="form-group">
          <label for="description" class="form-label">
            <span class="label-text">Descripción</span>
            <span class="optional">(opcional)</span>
          </label>
          <div class="input-wrapper">
            <textarea
              id="description"
              formControlName="description"
              placeholder="Agrega detalles sobre esta tarea..."
              class="form-textarea"
              rows="3"
              [class.error]="descriptionControl?.invalid && descriptionControl?.touched"></textarea>
          </div>
          <div class="form-errors" *ngIf="descriptionControl?.invalid && descriptionControl?.touched">
            <span *ngIf="descriptionControl?.errors?.['maxlength']" class="error-message">
              Máximo 500 caracteres
            </span>
          </div>
        </div>

        <!-- Category & Priority Row -->
        <div class="form-row">
          <!-- Category Field -->
          <div class="form-group">
            <label for="category" class="form-label">
              <span class="label-text">Categoría</span>
            </label>
            <div class="select-wrapper">
              <select id="category" formControlName="category" class="form-select">
                <option *ngFor="let category of categories" [value]="category.id">
                  {{ category.icon }} {{ category.name }}
                </option>
              </select>
            </div>
          </div>

          <!-- Priority Field -->
          <div class="form-group">
            <label for="priority" class="form-label">
              <span class="label-text">Prioridad</span>
            </label>
            <div class="priority-options">
              <label *ngFor="let priority of priorities" 
                     class="priority-option"
                     [style.--priority-color]="priority.color">
                <input 
                  type="radio" 
                  [value]="priority.id" 
                  formControlName="priority">
                <span class="priority-indicator"></span>
                <span class="priority-label">{{ priority.name }}</span>
              </label>
            </div>
          </div>
        </div>

        <!-- Due Date Field -->
        <div class="form-group">
          <label for="dueDate" class="form-label">
            <span class="label-text">Fecha límite</span>
            <span class="optional">(opcional)</span>
          </label>
          <div class="input-wrapper">
            <input
              id="dueDate"
              type="date"
              formControlName="dueDate"
              class="form-input date-input">
            <div class="input-icon">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3H18V1M17,12H12V17H17V12Z"/>
              </svg>
            </div>
          </div>
        </div>

        <!-- Completed Checkbox (only in edit mode) -->
        <div class="form-group" *ngIf="mode === 'edit'">
          <label class="checkbox-wrapper">
            <input type="checkbox" formControlName="completed" class="checkbox-input">
            <span class="checkbox-custom">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" class="checkbox-icon">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
              </svg>
            </span>
            <span class="checkbox-label">Marcar como completada</span>
          </label>
        </div>

      </form>
    </div>

    <!-- Modal Footer -->
    <footer class="modal-footer">
      <button 
        type="button" 
        class="btn btn-secondary" 
        (click)="onClose()">
        Cancelar
      </button>
      <button 
        type="submit" 
        class="btn btn-primary" 
        [disabled]="todoForm.invalid"
        (click)="onSave()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M17,12C17,17.55 21.45,22 27,22C32.55,22 37,17.55 37,12C37,6.45 32.55,2 27,2C21.45,2 17,6.45 17,12M19,12C19,7.58 22.58,4 27,4C31.42,4 35,7.58 35,12C35,16.42 31.42,20 27,20C22.58,20 19,16.42 19,12M23,16L26,19L33,12L35,14L26,23L21,18L23,16Z" *ngIf="mode === 'create'"/>
          <path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z" *ngIf="mode === 'edit'"/>
        </svg>
        {{ getSaveButtonText() }}
      </button>
    </footer>

  </div>
</div>
