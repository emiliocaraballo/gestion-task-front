<div class="kanban-board">
  <div class="kanban-columns">
    <div 
      class="kanban-column" 
      *ngFor="let column of columns"
      [style.border-top-color]="column.color">
      
      <div class="column-header">
        <div class="column-title">
          <span class="column-icon">{{ column.icon }}</span>
          <h3>{{ column.title }}</h3>
          <span class="task-count">{{ column.tasks.length }}</span>
        </div>
      </div>

      <div 
        class="column-content"
        cdkDropList
        [id]="column.id"
        [cdkDropListData]="column.tasks"
        [cdkDropListConnectedTo]="getColumnConnectedTo()"
        (cdkDropListDropped)="onDrop($event)">
        
        <div 
          class="kanban-card"
          *ngFor="let task of column.tasks"
          cdkDrag
          [class.overdue]="isOverdue(task)">
          
          <div class="card-header">
            <div class="card-priority" [style.background-color]="getPriorityColor(task.priority || 'medium')"></div>
            <button class="card-edit-btn" (click)="onEditTask(task)" title="Editar tarea">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
              </svg>
            </button>
          </div>

          <div class="card-content">
            <h4 class="card-title">{{ task.title }}</h4>
            <p class="card-description" *ngIf="task.description">{{ task.description }}</p>
            
            <div class="card-meta">
              <div class="card-category" *ngIf="task.category">
                <span class="category-icon">{{ getCategoryIcon(task.category) }}</span>
                <span class="category-text">{{ task.category }}</span>
              </div>
              
              <div class="card-due-date" *ngIf="task.dueDate" [class.overdue]="isOverdue(task)">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
                </svg>
                <span>{{ formatDate(task.dueDate) }}</span>
              </div>
            </div>
          </div>

          <!-- Drag preview -->
          <div *cdkDragPreview class="drag-preview">
            <div class="preview-header">
              <div class="preview-priority" [style.background-color]="getPriorityColor(task.priority || 'medium')"></div>
              <span class="preview-title">{{ task.title }}</span>
            </div>
          </div>
        </div>

        <!-- Empty state -->
        <div class="column-empty" *ngIf="column.tasks.length === 0">
          <div class="empty-icon">{{ column.icon }}</div>
          <p>Sin tareas</p>
        </div>
      </div>
    </div>
  </div>
</div>
